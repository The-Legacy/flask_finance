{% extends "base.html" %}

{% block title %}Dashboard - Personal Finance Tracker{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4"><i class="bi bi-speedometer2"></i> Financial Dashboard</h1>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title">Total Income (This Month)</h6>
                        <h3 class="mb-0">${{ "%.2f"|format(monthly_income) }}</h3>
                    </div>
                    <i class="bi bi-arrow-up-circle fs-1"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card bg-danger text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title">Total Expenses (This Month)</h6>
                        <h3 class="mb-0">${{ "%.2f"|format(monthly_expenses) }}</h3>
                    </div>
                    <i class="bi bi-arrow-down-circle fs-1"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card bg-warning text-dark">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title">Tax Amount (This Month)</h6>
                        {% if monthly_tax_amount > 0 %}
                            <h3 class="mb-0">${{ "%.2f"|format(monthly_tax_amount) }}</h3>
                        {% else %}
                            <h3 class="mb-0">--</h3>
                        {% endif %}
                    </div>
                    <i class="bi bi-receipt fs-1"></i>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 mb-3">
        <div class="card {% if monthly_net_balance >= 0 %}bg-info{% else %}bg-secondary{% endif %} text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title">Net Balance</h6>
                        <h3 class="mb-0">${{ "%.2f"|format(monthly_net_balance) }}</h3>
                    </div>
                    <i class="bi bi-wallet2 fs-1"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Budget vs Actual Analysis -->
{% if budget_analysis %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">
                    <i class="bi bi-pie-chart"></i> Budget vs Actual Spending - {{ budget_analysis.active_budget.name }}
                </h5>
            </div>
            <div class="card-body">
                <!-- Budget Summary -->
                <div class="row mb-4">
                    <div class="col-md-4 text-center">
                        <h6>Total Budgeted</h6>
                        <h4 class="text-primary">${{ "{:,.2f}".format(budget_analysis.total_budgeted) }}</h4>
                    </div>
                    <div class="col-md-4 text-center">
                        <h6>Total Spent</h6>
                        <h4 class="{% if budget_analysis.total_spent > budget_analysis.total_budgeted %}text-danger{% else %}text-success{% endif %}">
                            ${{ "{:,.2f}".format(budget_analysis.total_spent) }}
                        </h4>
                    </div>
                    <div class="col-md-4 text-center">
                        <h6>Remaining Budget</h6>
                        <h4 class="{% if budget_analysis.budget_remaining < 0 %}text-danger{% else %}text-success{% endif %}">
                            ${{ "{:,.2f}".format(budget_analysis.budget_remaining) }}
                        </h4>
                    </div>
                </div>
                
                <!-- Category Breakdown -->
                <div class="row">
                    {% for category, data in budget_analysis.budget_vs_actual.items() %}
                    {% if data.budget > 0 %}
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-title">{{ category }}</h6>
                                <div class="progress mb-2" style="height: 10px;">
                                    <div class="progress-bar {% if data.percentage_used > 100 %}bg-danger{% elif data.percentage_used > 80 %}bg-warning{% else %}bg-success{% endif %}" 
                                         role="progressbar" 
                                         style="width: {{ data.percentage_used|round(1) }}%"
                                         aria-valuenow="{{ data.percentage_used|round(1) }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <small>Spent: ${{ "{:,.0f}".format(data.actual) }}</small>
                                    <small>Budget: ${{ "{:,.0f}".format(data.budget) }}</small>
                                </div>
                                <div class="text-center mt-1">
                                    <small class="{% if data.remaining < 0 %}text-danger{% else %}text-success{% endif %}">
                                        {% if data.remaining >= 0 %}
                                            ${{ "{:,.0f}".format(data.remaining) }} remaining
                                        {% else %}
                                            ${{ "{:,.0f}".format(-data.remaining) }} over budget
                                        {% endif %}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
                
                <!-- Unmapped Spending Alert -->
                {% if budget_analysis.total_unmapped > 0 %}
                <div class="alert alert-warning mt-4">
                    <h6><i class="bi bi-exclamation-triangle"></i> Unmapped Spending Detected</h6>
                    <p class="mb-2">The following spending categories aren't tracked against your budget:</p>
                    <div class="row">
                        {% for category, amount in budget_analysis.unmapped_spending.items() %}
                        <div class="col-md-4 mb-2">
                            <span class="badge bg-warning text-dark me-2">{{ category }}</span>
                            <strong>${{ "{:,.0f}".format(amount) }}</strong>
                        </div>
                        {% endfor %}
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between align-items-center">
                        <span><strong>Total Unmapped: ${{ "{:,.0f}".format(budget_analysis.total_unmapped) }}</strong></span>
                        <small class="text-muted">Consider updating your budget categories or transaction categories for better tracking</small>
                    </div>
                </div>
                {% endif %}
                
                <div class="text-center mt-3">
                    <a href="{{ url_for('budget') }}" class="btn btn-outline-primary">
                        <i class="bi bi-pencil"></i> Adjust Budget
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-info">
            <h6><i class="bi bi-info-circle"></i> No Budget Plan Found</h6>
            <p class="mb-2">Create a budget plan to track your spending against your financial goals.</p>
            <a href="{{ url_for('budget') }}" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Create Budget Plan
            </a>
        </div>
    </div>
</div>
{% endif %}

<!-- Tax Cost Breakdown -->
{% if tax_breakdown %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="card-title mb-0">
                    <i class="bi bi-receipt-cutoff"></i> Estimated Annual Tax Breakdown
                </h5>
            </div>
            <div class="card-body">
                <!-- Tax Summary -->
                <div class="row mb-4">
                    <div class="col-md-3 text-center">
                        <h6>Annual Income</h6>
                        <h4 class="text-primary">${{ "{:,.0f}".format(tax_breakdown.annual_income) }}</h4>
                    </div>
                    <div class="col-md-3 text-center">
                        <h6>Total Annual Taxes</h6>
                        <h4 class="text-danger">${{ "{:,.0f}".format(tax_breakdown.tax_details.total_annual) }}</h4>
                    </div>
                    <div class="col-md-3 text-center">
                        <h6>Monthly Tax Cost</h6>
                        <h4 class="text-warning">${{ "{:,.0f}".format(tax_breakdown.monthly_taxes) }}</h4>
                    </div>
                    <div class="col-md-3 text-center">
                        <h6>Effective Tax Rate</h6>
                        <h4 class="text-info">{{ "{:.1f}".format(tax_breakdown.effective_rate) }}%</h4>
                    </div>
                </div>
                
                <!-- Tax Component Breakdown -->
                <div class="row">
                    <div class="col-md-8">
                        <h6>Tax Components</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card border-primary">
                                    <div class="card-body p-3">
                                        <h6 class="card-title text-primary">Federal Income Tax</h6>
                                        <h4>${{ "{:,.0f}".format(tax_breakdown.tax_details.federal_income) }}</h4>
                                        <small class="text-muted">
                                            ${{ "{:,.0f}".format(tax_breakdown.tax_details.federal_income / 12) }}/month
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            {% if tax_breakdown.tax_details.federal_payroll > 0 %}
                            <div class="col-md-6 mb-3">
                                <div class="card border-info">
                                    <div class="card-body p-3">
                                        <h6 class="card-title text-info">Payroll Taxes (FICA)</h6>
                                        <h4>${{ "{:,.0f}".format(tax_breakdown.tax_details.federal_payroll) }}</h4>
                                        <small class="text-muted">
                                            Social Security & Medicare
                                        </small>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if tax_breakdown.tax_details.self_employment > 0 %}
                            <div class="col-md-6 mb-3">
                                <div class="card border-success">
                                    <div class="card-body p-3">
                                        <h6 class="card-title text-success">Self-Employment Tax</h6>
                                        <h4>${{ "{:,.0f}".format(tax_breakdown.tax_details.self_employment) }}</h4>
                                        <small class="text-muted">
                                            SS & Medicare for 1099 workers
                                        </small>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if tax_breakdown.tax_details.state_tax > 0 %}
                            <div class="col-md-6 mb-3">
                                <div class="card border-warning">
                                    <div class="card-body p-3">
                                        <h6 class="card-title text-warning">{{ tax_breakdown.state_name }}</h6>
                                        <h4>${{ "{:,.0f}".format(tax_breakdown.tax_details.state_tax) }}</h4>
                                        <small class="text-muted">
                                            State income tax
                                        </small>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if tax_breakdown.tax_details.local_tax > 0 %}
                            <div class="col-md-6 mb-3">
                                <div class="card border-secondary">
                                    <div class="card-body p-3">
                                        <h6 class="card-title text-secondary">{{ tax_breakdown.city_name }}</h6>
                                        <h4>${{ "{:,.0f}".format(tax_breakdown.tax_details.local_tax) }}</h4>
                                        <small class="text-muted">
                                            Local income tax
                                        </small>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6>Tax Planning Tips</h6>
                                <ul class="mb-0 small">
                                    <li>Consider increasing 401(k) contributions to reduce taxable income</li>
                                    <li>Track tax-deductible expenses throughout the year</li>
                                    {% if tax_breakdown.tax_details.self_employment > 0 %}
                                    <li>Make quarterly estimated tax payments to avoid penalties</li>
                                    <li>Track business expenses for deductions</li>
                                    {% endif %}
                                    <li>Review withholding annually or after major life changes</li>
                                </ul>
                                <div class="mt-3">
                                    <a href="{{ url_for('taxes') }}" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-calculator"></i> Full Tax Calculator
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Charts Row -->
<div class="row mb-4">
    <div class="col-md-6 mb-3">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Spending by Category</h5>
            </div>
            <div class="card-body">
                <canvas id="spendingChart" width="400" height="400"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-3">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Income vs Expenses</h5>
            </div>
            <div class="card-body">
                <canvas id="incomeExpenseChart" width="400" height="400"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Portfolio & Debt Summary -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Investment Portfolio</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <h6>Invested</h6>
                        <h5 class="text-primary">${{ "%.2f"|format(total_invested) }}</h5>
                    </div>
                    <div class="col-6">
                        <h6>Current Value</h6>
                        <h5 class="{% if portfolio_gain_loss >= 0 %}text-success{% else %}text-danger{% endif %}">
                            ${{ "%.2f"|format(current_portfolio_value) }}
                        </h5>
                    </div>
                </div>
                <hr>
                <div class="text-center">
                    <h6>Gain/Loss</h6>
                    <h4 class="{% if portfolio_gain_loss >= 0 %}text-success{% else %}text-danger{% endif %}">
                        {% if portfolio_gain_loss >= 0 %}+{% endif %}${{ "%.2f"|format(portfolio_gain_loss) }}
                    </h4>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Debt Summary</h5>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <h6>Total Debt</h6>
                    <h4 class="text-danger">${{ "%.2f"|format(total_debt) }}</h4>
                </div>
                <hr>
                {% if loans %}
                    <small class="text-muted">Active Loans: {{ loans|length }}</small>
                {% else %}
                    <p class="text-muted mb-0">No active loans</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#addTransactionModal">
                        <i class="bi bi-plus-circle"></i> Add Transaction
                    </button>
                    <a href="{{ url_for('transactions') }}" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-list-ul"></i> View All Transactions
                    </a>
                    <a href="{{ url_for('taxes') }}" class="btn btn-outline-info btn-sm">
                        <i class="bi bi-calculator"></i> Tax Calculator
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Transactions -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Recent Transactions</h5>
                <a href="{{ url_for('transactions') }}" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body">
                {% if transactions %}
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Account</th>
                                    <th>Type</th>
                                    <th class="text-end">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for transaction in transactions %}
                                <tr>
                                    <td>{{ transaction.date.strftime('%m/%d/%Y') }}</td>
                                    <td>{{ transaction.description or '-' }}</td>
                                    <td><span class="badge bg-secondary">{{ transaction.category }}</span></td>
                                    <td>
                                        {% if transaction.account %}
                                            <span class="badge bg-info">{{ transaction.account.name }}</span>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge {% if transaction.transaction_type == 'income' %}bg-success{% else %}bg-danger{% endif %}">
                                            {{ transaction.transaction_type.title() }}
                                        </span>
                                    </td>
                                    <td class="text-end {% if transaction.transaction_type == 'income' %}text-success{% else %}text-danger{% endif %}">
                                        {% if transaction.transaction_type == 'income' %}+{% else %}-{% endif %}${{ "%.2f"|format(transaction.amount) }}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted text-center">No transactions yet. <a href="{{ url_for('transactions') }}">Add your first transaction</a>.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Quick Add Transaction Modal -->
<div class="modal fade" id="addTransactionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Transaction</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('add_transaction') }}" method="POST">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Transaction Type *</label>
                        <select class="form-select" name="transaction_type" id="modal_transaction_type" required>
                            <option value="">Choose transaction type...</option>
                            <option value="income">ðŸ’° Income</option>
                            <option value="expense">ðŸ’¸ Expense</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Category *</label>
                        <select class="form-select" name="category" id="modal_category_select" required disabled>
                            <option value="">Select transaction type first...</option>
                        </select>
                        <input type="text" class="form-control mt-2" name="custom_category" id="modal_custom_category" 
                               placeholder="Or enter custom category" style="display: none;">
                        <div class="form-check mt-2" style="display: none;" id="modal_custom_category_check">
                            <input class="form-check-input" type="checkbox" id="modal_use_custom" name="use_custom">
                            <label class="form-check-label" for="modal_use_custom">
                                Use custom category
                            </label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Account</label>
                        <select class="form-select" name="account_id">
                            <option value="">No specific account</option>
                            {% for account in accounts %}
                            <option value="{{ account.id }}">
                                {{ account.name }} 
                                {% if account.bank_name %}({{ account.bank_name }}){% endif %}
                                - ${{ "%.2f"|format(account.current_balance) }}
                            </option>
                            {% endfor %}
                        </select>
                        <small class="text-muted">Optional: Select which account this transaction affects</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Amount *</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" name="amount" step="0.01" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Date *</label>
                        <input type="date" class="form-control" name="date" value="{{ date.today() }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <input type="text" class="form-control" name="description" 
                               placeholder="Optional description">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Transaction</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Define category options (same as in transactions.html)
const categoryOptions = {
    income: [
        'Salary', 'Freelance', 'Business Income', 'Investment Returns', 'Rental Income',
        'Side Hustle', 'Bonus', 'Gift', 'Tax Refund', 'Other Income'
    ],
    expense: [
        'Housing', 'Rent', 'Mortgage', 'Property Tax', 'Home Insurance', 'Home Maintenance',
        'Food & Dining', 'Groceries', 'Restaurants', 'Coffee', 'Takeout',
        'Transportation', 'Gas', 'Car Payment', 'Car Insurance', 'Public Transit', 'Uber/Lyft', 'Car Maintenance',
        'Utilities', 'Electric', 'Gas', 'Water', 'Internet', 'Phone', 'Trash',
        'Healthcare', 'Medical', 'Dental', 'Pharmacy', 'Health Insurance', 'Vision',
        'Entertainment', 'Movies', 'Games', 'Subscriptions', 'Hobbies', 'Sports', 'Books',
        'Shopping', 'Clothing', 'Electronics', 'Online Shopping', 'Home Goods',
        'Personal Care', 'Beauty', 'Haircut', 'Gym', 'Spa',
        'Education', 'Tuition', 'Books', 'Courses', 'Training',
        'Insurance', 'Life Insurance', 'Disability Insurance', 'Umbrella Insurance',
        'Other'
    ]
};

document.addEventListener('DOMContentLoaded', function() {
    // Initialize Bootstrap tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    });

    // Handle modal category selection
    const modalTransactionTypeSelect = document.getElementById('modal_transaction_type');
    const modalCategorySelect = document.getElementById('modal_category_select');
    const modalCustomCategoryInput = document.getElementById('modal_custom_category');
    const modalCustomCategoryCheck = document.getElementById('modal_custom_category_check');
    const modalUseCustomCheckbox = document.getElementById('modal_use_custom');
    
    if (modalTransactionTypeSelect) {
        modalTransactionTypeSelect.addEventListener('change', function() {
            const selectedType = this.value;
            
            // Clear and enable category select
            modalCategorySelect.innerHTML = '<option value="">Choose category...</option>';
            
            if (selectedType && categoryOptions[selectedType]) {
                modalCategorySelect.disabled = false;
                
                // Populate category options
                categoryOptions[selectedType].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    modalCategorySelect.appendChild(option);
                });
                
                // Show custom category option
                modalCustomCategoryCheck.style.display = 'block';
            } else {
                modalCategorySelect.disabled = true;
                modalCustomCategoryCheck.style.display = 'none';
                modalCustomCategoryInput.style.display = 'none';
            }
        });
        
        // Handle custom category checkbox in modal
        modalUseCustomCheckbox.addEventListener('change', function() {
            if (this.checked) {
                modalCustomCategoryInput.style.display = 'block';
                modalCategorySelect.disabled = true;
                modalCustomCategoryInput.required = true;
                modalCategorySelect.required = false;
            } else {
                modalCustomCategoryInput.style.display = 'none';
                modalCategorySelect.disabled = false;
                modalCustomCategoryInput.required = false;
                modalCategorySelect.required = true;
            }
        });
    }

    // Load spending by category chart
    fetch('/api/chart_data?type=spending_by_category')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('spendingChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.data,
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                            '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        });
    
    // Load income vs expenses chart
    fetch('/api/chart_data?type=income_vs_expenses')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('incomeExpenseChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Income',
                        data: data.income,
                        backgroundColor: '#28a745'
                    }, {
                        label: 'Expenses',
                        data: data.expenses,
                        backgroundColor: '#dc3545'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
});
</script>
{% endblock %}
